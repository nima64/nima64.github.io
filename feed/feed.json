{
	"version": "https://jsonfeed.org/version/1.1",
	"title": "nyima tamang blog",
	"language": "en",
	"home_page_url": "https://example.com/",
	"feed_url": "https://example.com/feed/feed.json",
	"description": "blog about math and computer science",
	"author": {
		"name": "nyima tamang",
		"url": "https://nima64.github.io/"
	},
	"items": [
		{
			"id": "https://example.com/blog/rfq-dayton/rfq-datyon/",
			"url": "https://example.com/blog/rfq-dayton/rfq-datyon/",
			"title": "Dayton Sheets",
			"content_html": "<p><picture><source type=\"image/avif\" srcset=\"https://example.com/img/IcGUwTk1rc-1366.avif 1366w\"><source type=\"image/webp\" srcset=\"https://example.com/img/IcGUwTk1rc-1366.webp 1366w\"><img alt=\"offers\" loading=\"lazy\" decoding=\"async\" src=\"https://example.com/img/IcGUwTk1rc-1366.png\" width=\"1366\" height=\"910\"></picture>\n<em>(buyer view)</em></p>\n<h2 id=\"building-dayton-sheets\" tabindex=\"-1\">Building Dayton Sheets <a class=\"header-anchor\" href=\"https://example.com/blog/rfq-dayton/rfq-datyon/\">#</a></h2>\n<p>In one week, Mario and I built a mvp quoting software for Dayton Financial. We converted their laborious process from entering seller data in a buyer sheet into a streamlined full stack web app. It saved the company thousands of dollars in monthly operation costs.</p>\n<p>The vision for the project was to have a master sheet with products that sellers could enter their quotes and they would be grouped and displayed. This setup of private sellers, a master sheet where any changes would reflect seller sheets and providing real time updates required real engineering and man hours to build the mvp in one week.</p>\n<p>We decided the on the following stack: <strong>Firebase, Tanstack, Nextjs, Typescript, Reactjs</strong></p>\n<h3 id=\"some-of-the-challenges-and-constraints-we-faced\" tabindex=\"-1\">Some of the challenges and constraints we faced <a class=\"header-anchor\" href=\"https://example.com/blog/rfq-dayton/rfq-datyon/\">#</a></h3>\n<ul>\n<li>Modeling data seller &amp; master sheets</li>\n<li>Data synchronizaiton between master &amp; seller</li>\n<li>responsive spreadsheet component(under 100ms render for input)</li>\n<li>can columns change?</li>\n<li>handle up to 100 sellers at anytime\n<ul>\n<li>at most 20,000 api firebase requests in an hour(Free tier limit)</li>\n</ul>\n</li>\n</ul>\n<p>How we solved these problems will be discussed in this blog</p>\n<h3 id=\"modeling-sellers-and-buyers\" tabindex=\"-1\">Modeling Sellers and Buyers <a class=\"header-anchor\" href=\"https://example.com/blog/rfq-dayton/rfq-datyon/\">#</a></h3>\n<p><picture><source type=\"image/avif\" srcset=\"https://example.com/img/lktV54tQxk-1554.avif 1554w\"><source type=\"image/webp\" srcset=\"https://example.com/img/lktV54tQxk-1554.webp 1554w\"><img alt=\"ERD\" loading=\"lazy\" decoding=\"async\" src=\"https://example.com/img/lktV54tQxk-1554.png\" width=\"1554\" height=\"1022\"></picture>\nArguably the hardest part of this project was modeling buyers and sellers. A seller's copies are contained inside buyer/template sheets. Because buyer sheets template updates are unidirectional, any update in the template must be applied to all seller sheets but not vice versa.\nWe decided to make the changes on the seller sheets only store the rows that were changed. The buyer display will take those changes and group them by their row id.</p>\n<pre class=\"language-javascript\" tabindex=\"0\"><code class=\"language-javascript\"> MasterSheet <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">templateId</span><span class=\"token operator\">:</span>  string<span class=\"token punctuation\">;</span>       <span class=\"token comment\">// PK</span>\n  <span class=\"token literal-property property\">buyerId</span><span class=\"token operator\">:</span>     string<span class=\"token punctuation\">;</span>       <span class=\"token comment\">// FK â†’ Buyer.userId</span>\n  <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span>       string<span class=\"token punctuation\">;</span>\n  <span class=\"token literal-property property\">columns</span><span class=\"token operator\">:</span>     string<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token literal-property property\">rows</span><span class=\"token operator\">:</span>        Row<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token literal-property property\">sellers</span><span class=\"token operator\">:</span>     string<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>     <span class=\"token comment\">// UserIds</span>\n  sellerCopies<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Record<span class=\"token operator\">&lt;</span>string<span class=\"token punctuation\">,</span> Row<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// optional per-seller view</span>\n<span class=\"token punctuation\">}</span>\n\n SellerCopy <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">templateId</span><span class=\"token operator\">:</span> string<span class=\"token punctuation\">;</span>  <span class=\"token comment\">// PK (composite)</span>\n  <span class=\"token literal-property property\">sellerId</span><span class=\"token operator\">:</span>   string<span class=\"token punctuation\">;</span>  <span class=\"token comment\">// PK</span>\n  <span class=\"token literal-property property\">rows</span><span class=\"token operator\">:</span>       Row<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">/// rest in on github....</span></code></pre>\n<br>\n<h3 id=\"handling-up-to-100-users-and-real-time-updates\" tabindex=\"-1\">Handling up to 100 users and real time updates <a class=\"header-anchor\" href=\"https://example.com/blog/rfq-dayton/rfq-datyon/\">#</a></h3>\n<p>We made the assumption of at most 100 users at any given time, so we had to figure out a way to limit our API requests to stay under Firebase's 20k requests per hour limit. If we sent updates every second, we would easily hit this limit, so we decided to implement a buffer that would hold the changes. We check this buffer every 3 seconds for changes and make a single API request if any exist.</p>\n<p><picture><source type=\"image/avif\" srcset=\"https://example.com/img/ZGJ_7F_0-t-1318.avif 1318w\"><source type=\"image/webp\" srcset=\"https://example.com/img/ZGJ_7F_0-t-1318.webp 1318w\"><img alt=\"seller-edit\" loading=\"lazy\" decoding=\"async\" src=\"https://example.com/img/ZGJ_7F_0-t-1318.png\" width=\"1318\" height=\"358\"></picture></p>\n<p>This approach had one big issue: race conditions. Luckily my background from Google Summer of Code helped me navigate this bug. The problem was that user changes could be added to the buffer during an API request, but then get cleared immediately after when we reset the buffer. This meant those changes would never be processed.\nThe solution was to implement a two-buffer system: a processed buffer that gets cleared immediately before each API call and a queque holds any changes that occur during the request, preventing data loss.</p>\n<pre class=\"language-typescript\" tabindex=\"0\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> queuedCells <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> processedCells <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map<span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">any</span><span class=\"token operator\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Pending API updates</span>\n\n<span class=\"token function\">setInterval</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>queuedCells<span class=\"token punctuation\">.</span>size <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Move user changes from queued to processed</span>\n    queuedCells<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>update<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      processedCells<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> update<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Latest value wins</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    queuedCells<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//async can trigger can the person is making changes to row</span>\n    <span class=\"token function\">makeApiCall</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/sheet/batch-update?\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        processedCells<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// dump processed cells back into queue  </span>\n        processedCells<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>update<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          queuedCells<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> update<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<h3 id=\"in-house-tanstack-grid-vs-commercial-grid\" tabindex=\"-1\">In house Tanstack grid vs commercial grid <a class=\"header-anchor\" href=\"https://example.com/blog/rfq-dayton/rfq-datyon/\">#</a></h3>\n<p>Towards the end of the project, we had to implement row grouping and column sorting. Mui grid and Ag-grid were upwards of 500-1k annually, and they were all built on top of tanstack. So naturally being the crafty engineers we were, we build our own grid on top of Tan Stack this way if we ever need to make changes to the grid we knew exactly how it worked with the added expense of technical debt hahahaha.</p>\n",
			"date_published": "2025-06-30T00:00:00Z"
		}
		,
		{
			"id": "https://example.com/blog/gsoc/gosc-6-24/",
			"url": "https://example.com/blog/gsoc/gosc-6-24/",
			"title": "Summer of code with Video Lan",
			"content_html": "<h2 id=\"overview-of-the-code\" tabindex=\"-1\">Overview of the Code <a class=\"header-anchor\" href=\"https://example.com/blog/gsoc/gosc-6-24/\">#</a></h2>\n<p><a href=\"https://github.com/thebamby/vlc-SmartLoad/pull/1\">Updated SmartLoad extension to support VLC 4.0</a><br>\n<a href=\"https://code.videolan.org/nima64/vlc/-/tree/autorun-module?ref_type=heads\">Auto-run branch</a><br>\n<a href=\"https://code.videolan.org/nima64/vlc/-/tree/tests-improvements?ref_type=heads\">Test improvements branch</a><br>\n<a href=\"https://code.videolan.org/nima64/vlc/-/tree/CMD_SET_INPUT-removal?ref_type=heads\">Remove traces of CMD_SET_INPUT branch</a><br>\n<a href=\"https://code.videolan.org/nima64/vlc/-/commit/cb2244b6f81d5c38e9aaddaf83aee09cd0905693\">Fixed Meta_Changed function from segfaulting branch</a></p>\n<h2 id=\"background\" tabindex=\"-1\">Background <a class=\"header-anchor\" href=\"https://example.com/blog/gsoc/gosc-6-24/\">#</a></h2>\n<h3 id=\"building-vlc\" tabindex=\"-1\">Building VLC <a class=\"header-anchor\" href=\"https://example.com/blog/gsoc/gosc-6-24/\">#</a></h3>\n<p>The latest repo is on <a href=\"https://code.videolan.org/videolan/vlc/\">gitlab</a> they have two build systems <strong>meson</strong> and <strong>gnu autotools</strong>.</p>\n<p>I ended up choosing meson because it generates a ninja builds which is significantly faster on my system than auto tools. Ninja also produces a compile_commands.json which is need for clangd setup.</p>\n<p>A blocking point in building vlc was finding the right the packages. Specifically qt packages which sometimes couldn't be recognized by pkg-conf. Eventually I found the packages from Ubuntu 21.10 worked, alternatively I could have built QT from source. I wasn't comfortable building QT, so I stuck with the latter.</p>\n<p>I found the correct packages to install from the looking at the QT build decencies in <em>vlc/modules/gui/qt/meson.build</em>. I would also look in vlc's docker images for finding linux dependencies.</p>\n<blockquote>\n<p>Note: to generate a compile_commands.json on autoools use bear.<br>\nAnd run <code>bear -- make</code></p>\n</blockquote>\n<pre class=\"language-js\" tabindex=\"0\"><code class=\"language-js\"><span class=\"token literal-property property\">modules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'Core'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Gui'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Widgets'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Svg'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Qml'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'QmlModels'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'QuickLayouts'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'QuickTemplates2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'QmlWorkerScript'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'Quick'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'QuickControls2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ShaderTools'</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></code></pre>\n<h3 id=\"comprehending-the-code-base\" tabindex=\"-1\">Comprehending the code base <a class=\"header-anchor\" href=\"https://example.com/blog/gsoc/gosc-6-24/\">#</a></h3>\n<p>Some useful resources<br>\n<a href=\"https://example.com/blog/gsoc/gosc-6-24/\">https://wiki.videolan.org/Hacker_Guide/</a><br>\n<a href=\"https://example.com/blog/gsoc/gosc-6-24/\">https://mfkl.gumroad.com/l/libvlc-good-parts</a><br>\n<a href=\"https://example.com/blog/gsoc/gosc-6-24/\">https://www.doxygen.nl/manual/</a></p>\n<p>I would recommend compiling your own documentation for source graphs. There are libvlc and libvlccore doxygen documentation online, but that didn't include any of the extensions system.</p>\n<h3 id=\"vlc-extension-system\" tabindex=\"-1\">VLC Extension System <a class=\"header-anchor\" href=\"https://example.com/blog/gsoc/gosc-6-24/\">#</a></h3>\n<p>Since my project is based around the lua extension system I will attempt to explain and show how it works in a brief paragraph.</p>\n<p>The key part in the extension system that controls the communication between vlc and extension code is the <em>extension manager</em>.\nThe extension manager holds all the extension data and contains a function, called control, which is the api that will handle commands. The function gets passed different command enums such as activate, deactivate, is_active... etc. And how the commands get handled is dependant your implementation.</p>\n<p>The implementation from the lua module says that commands will get pushed onto queue. And on separate thread &quot;extension thread&quot; will execute commands and trigger a function in the lua code.\n<picture><source type=\"image/avif\" srcset=\"https://example.com/img/QdVW8DtiSD-2752.avif 2752w\"><source type=\"image/webp\" srcset=\"https://example.com/img/QdVW8DtiSD-2752.webp 2752w\"><img alt=\"test\" loading=\"lazy\" decoding=\"async\" src=\"https://example.com/img/QdVW8DtiSD-2752.jpeg\" width=\"2752\" height=\"1040\"></picture></p>\n<h2 id=\"what-i-did\" tabindex=\"-1\">What I did <a class=\"header-anchor\" href=\"https://example.com/blog/gsoc/gosc-6-24/\">#</a></h2>\n<h3 id=\"removing-cmd-set-input\" tabindex=\"-1\">Removing CMD_SET_INPUT <a class=\"header-anchor\" href=\"https://example.com/blog/gsoc/gosc-6-24/\">#</a></h3>\n<p><a href=\"https://code.videolan.org/videolan/vlc/-/merge_requests/3240\">my mentors work</a></p>\n<p><a href=\"https://code.videolan.org/nima64/vlc/-/tree/CMD_SET_INPUT-removal?ref_type=heads\">Remove traces of CMD_SET_INPUT branch</a></p>\n<p>This was a continuation of my mentors work deprecating CMD_SET_INPUT through ui commands, since it now gets binded to player's input changed event.</p>\n<h3 id=\"adding-missing-testing\" tabindex=\"-1\">Adding missing Testing <a class=\"header-anchor\" href=\"https://example.com/blog/gsoc/gosc-6-24/\">#</a></h3>\n<p><a href=\"https://code.videolan.org/nima64/vlc/-/compare/master...tests-improvements?from_project_id=435\">Test improvements branch</a></p>\n<p>One of the goals for my project is to create tests for the extension commands. Only playing_changed had been done the rest needed to be implemented. Testing each command is just checking if the callback in the lua code got executed. The is achieved through blocking our main thread with a semaphore until the lua callback is triggered, from extension thread, signals to unblock the code.</p>\n<pre class=\"language-c\" tabindex=\"0\"><code class=\"language-c\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">enum</span>\n<span class=\"token punctuation\">{</span>\n    CMD_ACTIVATE <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    CMD_DEACTIVATE<span class=\"token punctuation\">,</span>\n    CMD_TRIGGERMENU<span class=\"token punctuation\">,</span>    <span class=\"token comment\">/* Arg1 = int*, pointing to id to trigger. free */</span>\n    CMD_CLICK<span class=\"token punctuation\">,</span>          <span class=\"token comment\">/* Arg1 = extension_widget_t* */</span>\n    CMD_CLOSE<span class=\"token punctuation\">,</span>\n    CMD_SET_INPUT<span class=\"token punctuation\">,</span>      <span class=\"token comment\">/* No arg. Just signal current input changed */</span>\n    CMD_UPDATE_META<span class=\"token punctuation\">,</span>    <span class=\"token comment\">/* No arg. Just signal current input item meta changed */</span>\n    CMD_PLAYING_CHANGED <span class=\"token comment\">/* Arg1 = int*, New playing status  */</span>\n<span class=\"token punctuation\">}</span> command_type_e<span class=\"token punctuation\">;</span>\n</code></pre>\n<h3 id=\"auto-run-feature\" tabindex=\"-1\">Auto-run feature <a class=\"header-anchor\" href=\"https://example.com/blog/gsoc/gosc-6-24/\">#</a></h3>\n<p><a href=\"https://code.videolan.org/videolan/vlc/-/merge_requests/5795/commits#note_448656\">Auto-run Merge Request</a></p>\n<p>Ideally extensions should be isolated in their own process and have a proper permission system which prompts the user when it uses features that are possible security risks like accessing the filesystem.\nCurrently the new Autorun Start function is not 100% done, it loads the data and the starting of the new extension threads and enabling marked extensions is naively done through the extension manager.</p>\n<p><picture><source type=\"image/avif\" srcset=\"https://example.com/img/lWwuuRp4Up-2918.avif 2918w\"><source type=\"image/webp\" srcset=\"https://example.com/img/lWwuuRp4Up-2918.webp 2918w\"><img alt=\"test\" loading=\"lazy\" decoding=\"async\" src=\"https://example.com/img/lWwuuRp4Up-2918.jpeg\" width=\"2918\" height=\"2207\"></picture></p>\n<p>Future Work</p>\n<ul>\n<li>\n<p>AutorunStart should create marked extension threads and enabled them.</p>\n</li>\n<li>\n<p>Extension thread should also be stopped by the last module using the state shared_ptr.</p>\n</li>\n</ul>\n<h2 id=\"hurdles-and-what-i-learned-from-them\" tabindex=\"-1\">Hurdles and What I learned From them <a class=\"header-anchor\" href=\"https://example.com/blog/gsoc/gosc-6-24/\">#</a></h2>\n<p>For large code bases make sure you understand the common code and libraries. For example in vlc how is oop implement, what are interfaces and modules.</p>\n<p>Don't focus on understanding what every line of code is doing, instead try to look at the big picture, what is this chunk of code doing?</p>\n<p>Ask questions, so you don't waste your time getting stuck on a problem for too long.</p>\n<p>Effective communication is incredibly important this is something I struggled with, learning how to communicate your ideas effectively and clearly is very difficult the idea in your head might be different than what someone else's. Being able to show what you mean so both parties can come to consensus is very important to a successful collaboration.<br>\nFor a complex module I found sharing diagrams to express the general idea first before proceeding to code was a huge time saver, so my mentor could check the validity of the idea before I started coding.</p>\n<h2 id=\"conclusion\" tabindex=\"-1\">Conclusion <a class=\"header-anchor\" href=\"https://example.com/blog/gsoc/gosc-6-24/\">#</a></h2>\n<p>I'm grateful to be able to partake in g'soc 24 with VLC. I was in awe of the inner workings of VLC. For the future I want to contribute more performance optimizations and low level related code like a video filter or adding the caching playlist probing.</p>\n<p>Thank you Alexandre Janniaux for your patience with me, teaching me to be better communicator, for always being there to support me and answer my questions and overall being an amazing mentor. And thank you Jean-Baptiste Kempf for making this possible.</p>\n",
			"date_published": "2024-06-01T00:00:00Z"
		}
		,
		{
			"id": "https://example.com/blog/svd-image-compression/",
			"url": "https://example.com/blog/svd-image-compression/",
			"title": "Singular Value Decomposition and it&#39;s use in Image compression.",
			"content_html": "<p>While reading through Strang's <em>Linear Algebra and It's Applications</em> I came upon this passage about SVD and one of it's many applications image compression.</p>\n<p><picture><source type=\"image/avif\" srcset=\"https://example.com/img/_Z8w6LZVpo-1584.avif 1584w\"><source type=\"image/webp\" srcset=\"https://example.com/img/_Z8w6LZVpo-1584.webp 1584w\"><img alt=\"test\" loading=\"lazy\" decoding=\"async\" src=\"https://example.com/img/_Z8w6LZVpo-1584.png\" width=\"1584\" height=\"926\"></picture></p>\n<p>SVD can be rewritten in a more compact form with the outer product being explicit.</p>\n<p>$$\\sum_{k=1}^{r}\\sigma_{k}u_{k} \\otimes v_{k}$$</p>\n<h2 id=\"how-svd-compression-works\" tabindex=\"-1\">How SVD Compression Works <a class=\"header-anchor\" href=\"https://example.com/blog/svd-image-compression/\">#</a></h2>\n<p>SVD compression lies on the fact most of the information is contained in very few singular values $$\\sigma$$ being very large while the rest are close to 0.</p>\n<p>The example by Strang: given a 1000x1000 matrix and say 98% of singular values are close to zero then we can get rid of them. So that only leaves us with 20 singular values, r=20, from the summation we only need 20 columns of U and V^T to reproduce the image.</p>\n<h2 id=\"testing-it-in-code-with-stbi-and-eigen\" tabindex=\"-1\">Testing it in code with stbi and Eigen <a class=\"header-anchor\" href=\"https://example.com/blog/svd-image-compression/\">#</a></h2>\n<pre class=\"language-cpp\" tabindex=\"0\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;Eigen/Dense></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;cstdio></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;cstdlib></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;fstream></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;malloc/_malloc.h></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;vector></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STB_IMAGE_IMPLEMENTATION</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"stb_image.h\"</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">STB_IMAGE_WRITE_IMPLEMENTATION</span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"stb_image_write.h\"</span></span>\n\n<span class=\"token keyword\">using</span> <span class=\"token keyword\">namespace</span> Eigen<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">compressImage</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>path<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">int</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span> <span class=\"token operator\">*</span>data <span class=\"token operator\">=</span> <span class=\"token function\">stbi_load</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>x<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>y<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>n<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">int</span> dataSize <span class=\"token operator\">=</span> x <span class=\"token operator\">*</span> y<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>data <span class=\"token operator\">==</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    std<span class=\"token double-colon punctuation\">::</span><span class=\"token function\">perror</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Failed to Open File!\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"x:%d y:%d n:%d\\n\"</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  Eigen<span class=\"token double-colon punctuation\">::</span>MatrixXd <span class=\"token function\">imgXY</span><span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Correct the order of y and x</span>\n\n  Eigen<span class=\"token double-colon punctuation\">::</span>Vector3f <span class=\"token function\">greyConversion</span><span class=\"token punctuation\">(</span><span class=\"token number\">0.299</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.587</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.114</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> dataSize<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">auto</span> dataRGB <span class=\"token operator\">=</span>\n        <span class=\"token class-name\">Eigen</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">Vector3f</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> n <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">[</span>i <span class=\"token operator\">*</span> n <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> greyCode <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span><span class=\"token punctuation\">)</span>dataRGB<span class=\"token punctuation\">.</span><span class=\"token function\">dot</span><span class=\"token punctuation\">(</span>greyConversion<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">int</span> row <span class=\"token operator\">=</span> i <span class=\"token operator\">/</span> x<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> col <span class=\"token operator\">=</span> i <span class=\"token operator\">%</span> x<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">imgXY</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">,</span> col<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> greyCode<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  BDCSVD<span class=\"token operator\">&lt;</span>MatrixXd<span class=\"token operator\">></span> <span class=\"token function\">svd</span><span class=\"token punctuation\">(</span>imgXY<span class=\"token punctuation\">,</span> ComputeFullU <span class=\"token operator\">|</span> Eigen<span class=\"token double-colon punctuation\">::</span>ComputeFullV<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  Eigen<span class=\"token double-colon punctuation\">::</span>VectorXd singularValues <span class=\"token operator\">=</span> svd<span class=\"token punctuation\">.</span><span class=\"token function\">singularValues</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">auto</span> i <span class=\"token operator\">=</span> singularValues<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">350</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">!=</span> singularValues<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    singularValues<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">auto</span> U <span class=\"token operator\">=</span> svd<span class=\"token punctuation\">.</span><span class=\"token function\">matrixU</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">auto</span> V <span class=\"token operator\">=</span> svd<span class=\"token punctuation\">.</span><span class=\"token function\">matrixV</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  Eigen<span class=\"token double-colon punctuation\">::</span>MatrixXd mSV <span class=\"token operator\">=</span> singularValues<span class=\"token punctuation\">.</span><span class=\"token function\">asDiagonal</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toDenseMatrix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  mSV<span class=\"token punctuation\">.</span><span class=\"token function\">conservativeResize</span><span class=\"token punctuation\">(</span>U<span class=\"token punctuation\">.</span><span class=\"token function\">cols</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> V<span class=\"token punctuation\">.</span><span class=\"token function\">cols</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"U cols: %lu rows: %lu\\n\"</span><span class=\"token punctuation\">,</span> U<span class=\"token punctuation\">.</span><span class=\"token function\">cols</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> U<span class=\"token punctuation\">.</span><span class=\"token function\">rows</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"msv cols: %lu rows: %lu\\n\"</span><span class=\"token punctuation\">,</span> mSV<span class=\"token punctuation\">.</span><span class=\"token function\">cols</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> mSV<span class=\"token punctuation\">.</span><span class=\"token function\">rows</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"V cols: %lu rows: %lu\\n\"</span><span class=\"token punctuation\">,</span> V<span class=\"token punctuation\">.</span><span class=\"token function\">cols</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> V<span class=\"token punctuation\">.</span><span class=\"token function\">rows</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Reconstruct the image matrix</span>\n  MatrixXd cImgMat <span class=\"token operator\">=</span> U <span class=\"token operator\">*</span> mSV <span class=\"token operator\">*</span> V<span class=\"token punctuation\">.</span><span class=\"token function\">transpose</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// convert to char for stbi</span>\n  std<span class=\"token double-colon punctuation\">::</span>vector<span class=\"token operator\">&lt;</span><span class=\"token keyword\">char</span><span class=\"token operator\">></span> charVec<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> row <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> row <span class=\"token operator\">&lt;</span> cImgMat<span class=\"token punctuation\">.</span><span class=\"token function\">rows</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> row<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> col <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> col <span class=\"token operator\">&lt;</span> cImgMat<span class=\"token punctuation\">.</span><span class=\"token function\">cols</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> col<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      charVec<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span><span class=\"token function\">cImgMat</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">,</span> col<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// stride is size of each row</span>\n  <span class=\"token function\">stbi_write_png</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lennaBW.png\"</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> charVec<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                 <span class=\"token keyword\">sizeof</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">stbi_image_free</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">compressImage</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lenna.png\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<h2 id=\"the-result\" tabindex=\"-1\">The result <a class=\"header-anchor\" href=\"https://example.com/blog/svd-image-compression/\">#</a></h2>\n<p>The image was converted gray scale for the sake of simplicity, for color you need to run SVD on all the channels.</p>\n<p><picture><source type=\"image/avif\" srcset=\"https://example.com/img/mHUjXZAPLB-512.avif 512w\"><source type=\"image/webp\" srcset=\"https://example.com/img/mHUjXZAPLB-512.webp 512w\"><img alt=\"test\" loading=\"lazy\" decoding=\"async\" src=\"https://example.com/img/mHUjXZAPLB-512.png\" width=\"512\" height=\"512\"></picture>\n<picture><source type=\"image/avif\" srcset=\"https://example.com/img/nQqlggC60c-512.avif 512w\"><source type=\"image/webp\" srcset=\"https://example.com/img/nQqlggC60c-512.webp 512w\"><img alt=\"test\" loading=\"lazy\" decoding=\"async\" src=\"https://example.com/img/nQqlggC60c-512.png\" width=\"512\" height=\"512\"></picture></p>\n",
			"date_published": "2023-12-01T00:00:00Z"
		}
		
	]
}
